<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="refresh" content="300" />
  <title>Wetter</title>
  <style>
    html {
      background-color: #2d3036;
    }

    body {
      font-family: Verdana, sans-serif;
      font-size: 1.5em;
      margin: 0.5em;
      text-align: center;
      color: #fff;
    }

    table td {
      border-top: solid;
      border-color: #fff;
    }

    p {
      white-space: nowrap;
    }

    .name {
      font-weight: bold;
      text-align: left;
    }

    .warning {
      color: #f60;
    }

    .red {
      color: red;
    }

    .blue {
      color: lightblue;
    }
  </style>
</head>

<body>
  <div>
    <table id="weather">
      <tr>
        <th class='name'>Name</th>
        <th width="80px">Höhe</th>
        <th width="80px">Uhrzeit</th>
        <th width="80px"><img src="resources/temp.png" alt="Temp °C" height="64px" width="64px"></th>
        <th width="80px"><img src="resources/wind.png" alt="Wind km/h" height="64px" width="64px"></th>
        <th width="80px"><img src="resources/boe.png" alt="Böe km/h" height="64px" width="64px"></th>
        <th width="80px"><img src="resources/snow.png" alt="HS cm" height="64px" width="64px"></th>
        <th width="80px"><img src="resources/deltasnow.png" alt="HS/48h cm" height="64px" width="64px"></th>
      </tr>
    </table>
  </div>
  <script src="https://www.salzburg.gv.at/lawine/Station.js"></script>
  <script>
    var weather_array = []
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'kuehroint'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'watzmann'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'watzmanngrat'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'trischuebel'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'brunftbergtiefe'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'blaueishuette'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'hinterberghorn'))
    weather_array.push(stationData['R01 Nordalpen'].find(station => station.name === 'hinterseeau'))
    var table = document.getElementById('weather');

    for (var i = 0; i < weather_array.length; i++) {
      if (weather_array[i]) {
        var row = table.insertRow(-1); // -1 is insert as last
        var cell = row.insertCell(- 1); // -1 is insert as last
        cell.className = 'title name'; //
        cell.innerHTML = (weather_array[i]['measuredData']['windStationName'] ?? weather_array[i]['measuredData']['hsStationName']).split(' ')[0]
        var cell = row.insertCell(- 1); // -1 is insert as last
        cell.className = 'Altitude'; //
        cell.innerHTML = weather_array[i]['measuredData']['windStationAltitude'] ?? weather_array[i]['measuredData']['hsStationAltitude']
        cell = row.insertCell(- 1); // -1 is insert as last
        cell.className = 'Time'; //
        const date = new Date(weather_array[i]['measuredData']['windEnd'] ?? weather_array[i]['measuredData']['hsEnd']);
        cell.innerHTML = date.toLocaleTimeString("de-DE", { hour: '2-digit', minute: '2-digit' })
        cell = row.insertCell(- 1); // -1 is insert as last
        const lt = weather_array[i]['measuredData']['values']['LT']
        if (lt < 5.0) {
          cell.className = 'LT blue'; //
        } else if (lt > 25.0) {
          cell.className = 'LT red'; //
        }
        else {
          cell.className = 'LT'; //
        }
        cell.innerHTML = lt
        cell = row.insertCell(- 1); // -1 is insert as last
        const wg = Math.round(weather_array[i]['measuredData']['values']['WG'])
        if (wg >= 50) {
          cell.className = 'WG red'; //
        }
        else if (wg >= 30) {
          cell.className = 'WG warning'; //
        } else {
          cell.className = 'WG'; //
        }
        cell.innerHTML = round(weather_array[i]['measuredData']['values']['WG'])
        cell = row.insertCell(- 1); // -1 is insert as last
        const wgBoe = Math.round(weather_array[i]['measuredData']['values']['WG_BOE'])
        if (wgBoe >= 50) {
          cell.className = 'WG_BOE red'; //
        }
        else if (wgBoe >= 30) {
          cell.className = 'WG_BOE warning'; //
        } else {
          cell.className = 'WG_BOE'; //
        }
        cell.innerHTML = round(weather_array[i]['measuredData']['values']['WG_BOE'])
        cell = row.insertCell(- 1); // -1 is insert as last
        cell.className = 'HS'; //
        cell.innerHTML = roundToFive(weather_array[i]['measuredData']['values']['HS'])
        cell = row.insertCell(- 1); // -1 is insert as last
        if (Math.round(weather_array[i]['measuredData']['values']['HSD48'] / 5) * 5 > 0) {
          cell.className = 'HSD48 warning'; //
        } else {
          cell.className = 'HSD48'; //
        }
        cell.innerHTML = roundToFive(weather_array[i]['measuredData']['values']['HSD48'])
      }
    }

    function round(x) {
      if (isNaN(x)) {
        return '-';
      }
      if (x < 0) {
        return 0;
      }
      return Math.round(x);
    }

    function roundToFive(x) {
      if (isNaN(x)) {
        return '-';
      }
      if (x < 0) {
        return 0;
      }
      return Math.round(x / 5) * 5;
    }

  </script>
</body>

</html>